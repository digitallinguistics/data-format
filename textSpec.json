{

  "definitions": {
    "tag": {
      "title": "Tag",
      "description": "A <dfn>tag</dfn> is a piece of metadata that can be applied to any linguistic object, in order to associate related objects together. Each DLX `Tag` object consists of a `category` and an optional `value` or subcategory. Both `category` and `value` must be text (numbers will be converted into text).",
      "type": "object",
      "required": ["category"],
      "additionalProperties": false,

      "properties": {
        "category": { "title": "Category", "type": "string", "description": "The category for this tag." },
        "value": { "title": "Value", "type": "string", "description": "The value for this tag." }
      }
    }
  },

  "oneOf": [
    { "properties": {
        "participants": {
          "description": "One of the persons in the Participants array must have a role of `speaker`. A more formalized way of expressing this constraint is given below. In prose form, it says that it must not be the case that every participant in the array does not have a `speaker` role (this is simply the inverse of saying that at least one participant in the array has a `speaker` role).",
          "not": {
            "items": {
              "title": "Participant",
              "type": "object",
              "not": {
                "properties": {
                  "role": { "title": "Role", "type": "string", "enum": ["speaker"] }
                }
              }
            }
          }
        }
      }
    },

    { "properties": {
        "phrases": {
          "title": "Phrases",
          "description": "Each phrase must have a non-empty `speaker` attribute. This is formalized below.",
          "type": "array",
          "allOf": [
            { "$ref": "#/properties/phrases" },
            { "items": { "required": ["speaker"] } }
          ]
        }
      }
    }
  ],

  "properties": {

    "location": { "title": "Location", "type": "string", "description": "A text description of the locale, neighborhood, city, region, locality, and/or country." },
    "note": { "title": "Note", "type": "string", "description": "Any notes about this text." },
    "tags": {
      "title": "Tags",
      "description": "An array of any tags for this text.",
      "type": "array",
      "uniqueItems": true,
      "items": { "$ref": "#/definitions/tag" }
    },
    
    "coordinates": {
      "title": "GeoJSON Coordinates",
      "description": "A pair of geographic coordinates where this text was recorded, following the GeoJSON specification for recording coordinates in an array: <a href=http://geojson.org/geojson-spec.html#positions>http://geojson.org/geojson-spec.html#positions</a>.",
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": { "title": "GeoJSON Coordinate", "type": "number", "maximum": 360, "minimum": -360 }
    },

    "mediaFiles": {
      "title": "Media",
      "type": "array",
      "uniqueItems": true,

      "items": {

        "title": "Media File",
        "description": "A <dfn>media file</dfn> is any audiovisual file associated with this text, including audio or video recordings, but also scans of notebook pages where the text was recorded, relevant pictures taken during recording, etc.",
        "type": "object",
        "required": ["docType", "fileType"],
        "additionalProperties": true,

        "properties": {

          "docType": { "title": "Documentation Type", "type": "string", "description": "The type of documentation this file is, e.g. video recording, notebook scan, etc."},
          "fileType": { "title": "File Type", "type": "string", "description": "A valid <a href=https://en.wikipedia.org/wiki/Media_type>internet media type</a>, e.g. `audio/wav`." },
          "length": { "title": "File Length", "type": "number", "description": "The length of the media file in seconds and milliseconds.", "pattern": "^[0-9]{1,2}.[0-9]+$" },
          "startTime": { "title": "Start Time", "type": "number", "description": "Within this media file, the time at which the relevant linguistic data starts. For example, if the camera started recording five minutes before the speaker began speaking, the `Start Time` would be 5 minutes from the start of the file (so 300.00 seconds). The time stamp should be in seconds and milliseconds, separated by a period, e.g. `12.573`, or `1.2`, or `167.78012`, etc.", "pattern": "^[0-9]{1,2}.[0-9]+$" },
          "endTime": { "title": "End Time", "type": "number", "description": "Within this media file, the time at which the relevant linguistic data ends. For example, if the camera recorded for five minutes after the speaker finished talking, the `End Time` would be the time 5 minutes before the end of the file. The time stamp should be in seconds and milliseconds, separated by a period, e.g. `12.573`, or `1.2`, or `167.78012`, etc.", "pattern": "^[0-9]{1,2}.[0-9]+$" },
          "note": { "title": "Note", "type": "string", "description": "Any notes to accompany this media file." },
          "url": { "title": "URL", "type": "string", "description": "A stable URL where this media item can be found. Must be a valid URI format.", "format": "uri" },

          "tags": {
            "title": "Tags",
            "type": "array",
            "uniqueItems": true,
            "items": { "$ref": "#/definitions/tag" }
          }
        }
      }
    },

    "participants": {
      "title": "Participants",
      "type": "array",
      "minItems": 1,
      "items": {
        "title": "Participant",
        "description": "A <dfn>participant</dfn> is anyone who contributed to the creation or analysis of the text, and the role they played (e.g. recording, transcribing, speaking, etc.). A `Participant` is not just a `Person` object (see the DLX <a href=personSpec.html>Person</a> specification for that), but rather it is an object which specifies the particular role a person played in producing this text. It is a pairing of person and role. The `person` field references a `Person` object, following the DLX <a href=personSpec.html'>Person</a> specification.",
        "type": "object",
        "required": ["name", "role"],

        "properties": {
          "abbreviation": { "title": "Abbreviation", "type": "string", "description": "The participant <dfn>abbreviation</dfn> is a human-readable key for referring to this person, usually but not always consisting of the person’s initials. Other schemas might be `A` and `B` respectively for speakers A and B, for example. The participant abbreviation may contain only letters a-z, A-Z, and numbers 0-9 (no spaces allowed)." },
          "name": { "title": "Name", "type": "string", "description": "The name of this participant. If a pseudonym is used for this participant, that pseudonym should be used here instead of the participant’s real name. Their real name should be stored in the `Person` object for that person." },
          "role": { "title": "Role", "type": "string", "description": "The role that this person played in the creation or curation of this text, e.g. speaker, translator, transcriber, rehearer, editor, checker, glosser, researcher, etc." },
          "person": { "title": "Person", "$ref": "http://digitallinguistics.github.io/personSpec.json", "description": "The `person` field references a `Person` object. This must be a valid `Person` object, following the <a href=personSpec.html>Person</a> specification." }
        }
      }
    },

    "phrases": {
      "title": "Phrases",
      "items": {
        "title": "Phrase",
        "description": "A <dfn>phrase</dfn> is a segmentation of a text above the word level. The DLX specification imposes no requirements regarding how linguists should implement this segmentation — a linguist may choose to segement the text based on intonation units, turns, sentences, or any other appropriate subdivision. A `Phrase` consists minimally of a `Transcription`, a `Translation`, and an array of `Words` (though the words array may be empty).<br>If the `participants` array in the `Text` contains a single `Participant` with the `role` of `speaker`, that speaker is assumed to be the speaker for every phrase in the `Text`. If there is more than one `Participant` in the text with the `role` of `speaker`, each `Phrase` must have its speaker specified in the `speaker` property.<br>If a phrase has a `startTime`, it must have an `endTime`, and vice versa.",
        "type": "object",
        "required": ["transcription", "translation", "words"],
        "dependencies": {
          "startTime": ["endTime"],
          "endTime": ["startTime"]
        },
        "additionalProperties": true,

        "properties": {

          "startTime": { "title": "Start Time", "description": "The starting timestamp for this phrase, in seconds and milliseconds.", "type": "number", "pattern": "^[0-9]{1,2}.[0-9]+$" },
          "endTime": { "title": "End Time", "description": "The ending timestamp for this phrase, in seconds and milliseconds.", "type": "number", "pattern": "^[0-9]{1,2}.[0-9]+$" },
          "note": { "title": "Note", "description": "Any additional notes about this phrase.", "type": "string" },
          "speaker": { "title": "Speaker", "description": "The person who spoke this phrase. This value must match either the `name` or `abbreviation` of a `Participant` in the `Participants` array.", "type": "string" },
          "tags": {
            "title": "Tags",
            "type": "array",
            "uniqueItems": true,
            "items": { "$ref": "#/definitions/tag" }
          },

          "transcription": {

            "title": "Transcription",
            "description": "A <dfn>transcription</dfn> is a phonemic representation of the phrase in a particular orthography. The `transcription` attribute may be either a simple text string (when only one orthography is being used for transcription), or an object whose attributes are different orthographies (when multiple orthographies are being used to represent the same phrase). There must be at least one transcription specified for every phrase.",

            "oneOf": [
              {
                "description": "The single transcription for this phrase. If this option is chosen, the `Text` object must have a `Default Transcription` specified. If there are multiple translations or representations of this transcription, `transcription` should be an object instead (see the other option for the `Transcription` object).",
                "type": "string"
              },
              {
                "description": "The transcriptions for this phrase. Use this option when the phrase has multiple transcriptions in different orthographies. The `transcription` attribute in this case should be an object containing each of these different representations. The attribute of each representation should be the name of the orthography, (e.g. `MixtecPhonemic`), while the value is the transcription itself. Each phrase must have at least 1 transcription within the `Transcription` object if this option is selected.",
                "type": "object",
                "minProperties": 1,
                "patternProperties": {
                  "^[(a-z)|(A-Z)|(0-9)]+$": {
                    "type": "string",
                    "title": "Transcription",
                    "description": "The transcription for this phrase, in the particular orthography specified by the attribute. The field name is the name of the orthography.",
                    "requireSelf": true
                  }
                },
                "additionalProperties": false
              }
            ]
          },

          "translation": {
            "title": "Translation",
            "description": "The translation(s) for this phrase. There may be multiple translations per phrase, in different languages or styles (e.g. literal vs. free translations, English vs. Swahili translations, etc.). The `Translation` may either be a simple string (when there is only one translation for the phrase), or an object whose attributes are the names of different orthographies (when there are multiple translations or types of translations for the phrase).",

            "oneOf": [
              {
                "type": "string",
                "description": "The single translation for this phrase. If this option is chosen, the `Text` object must have a `Default Translation` specified. If there are multiple translations or representations of this translation, `translation` should be an object instead (see the other option for the `Translation` object)."
              },
              {
                "type": "object",
                "description": "The translations for this phrase. Use this option when the phrase has multiple translations in different orthographies or different styles. The `translation` attribute in this case should be an object containing each of these different translations. The attribute of each representation should be the name of the orthography, (e.g. `EnglishLiteral`), while the value is the translation itself. Each phrase must have at least 1 translation within the `Translation` object if this option is selected, although the value may be an empty string.",
                "minProperties": 1,
                "patternProperties": {
                  "^[(a-z)|(A-Z)|(0-9)]+$": { "type": "string", "title": "Translation", "description": "The translation for this phrase, in the particular orthography specified by the attribute. The field name is the name of the orthography.", "requireSelf": true }
                },
                "additionalProperties": false
              }
            ]
          },

          "words": {
            "type": "array",
            "items": {

              "title": "Word",
              "description": "A <dfn>word</dfn> is typically defined as the smallest freestanding unit in a language, although this unit varies depending on whether one uses phonological or syntactic criteria. A linguistic word conists of one or more morphemes. A DLX `Word` object consists minimally of a `'token'` string and an array of `'morphemes'` (even if the array is empty).",
              "type": "object",
              "required": ["morphemes", "token"],
              "additionalProperties": true,

              "properties": {

                "note": { "type": "string" },

                "glosses": {
                  "title": "Word Glosses",
                  "description": "A <dfn>word gloss</dfn> is a brief annotation of a word, morpheme, or other linguistic structure in a text. The `Word Glosses` object contains all the word-level glosses for a given word (glosses for individual morphemes within the word are provided in the `Morpheme` object; word glosses only gloss the word as a whole). The attribute (key, field name) for each gloss is the type of gloss, e.g. 'pedagogical' or 'Leipzig', while the value for the gloss is the gloss itself, e.g. '<span style='font-variant: small-caps;'>DET</span>' or 'he.eats'.",
                  "type": "object",

                  "patternProperties": {
                    "^[(a-z)|(A-Z)|(0-9)]+$": { "type": "string", "title": "Gloss" }
                  },

                  "additionalProperties": false
                },

                "token": {
                  "title": "Word Token",
                  "description": "A <dfn>word token</dfn> is an individual instance of a word in context (as opposed to an abstract <dfn>word type</dfn> or <dfn>wordform</dfn>). Like phrases, each word token can be transcribed using different orthographies or conventions. The `Token` object holds all of those transcriptions of the individual token. The `Token` object is required, and must contain at least 1 representation of the token.",
                  "type": "object",
                  "minProperties": 1,

                  "patternProperties": {
                    "^[(a-z)|(A-Z)|(0-9)]+$": { "type": "string", "title": "Representation" }
                  },

                  "additionalProperties": false
                },

                "tags": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": { "$ref": "#/definitions/tag" }
                },

                "morphemes": {

                  "type": "array",
                  "uniqueItems": false,
                  "items": {

                    "title": "Morpheme",
                    "description": "A <dfn>morpheme</dfn> is generally defined as the smallest grammatical unit, or unit of meaning, in a language. Each `Morpheme` object within a `Text` represents a linguistic token of that morpheme, rather than a type. A `Morpheme` consists minimally of `'token'` and `'gloss'` strings.",
                    "type": "object",
                    "required": ["token", "glosses"],
                    "additionalProperties": true,

                    "properties": {

                      "note": { "type": "string" },

                      "token": {
                        "title": "Morpheme Token",
                        "description": "A <dfn>morpheme token</dfn> is a specific instance of a morpheme in context (as opposed to an abstract <dfn>morpheme type</dfn> that you might find in a dictionary). The `Morphme Token` object contains all the representations/transcriptions of a particular morpheme token. The `Morpheme Token` object is required, and must have at least 1 representation of the token in it.",
                        "type": "object",
                        "minProperties": 1,

                        "patternProperties": {
                          "^[(a-z)|(A-Z)|(0-9)]+$": { "type": "string", "title": "Representation" }
                        },

                        "additionalProperties": false
                      },

                      "glosses": {
                        "title": "Morpheme Glosses",
                        "description": "A <dfn>morpheme gloss</dfn> is a brief annotation of the meaning of a morpheme. The `Morpheme Glosses` object contains all the glosses for a given morpheme. The attribute (key, field name) for each gloss is the type of gloss, e.g. 'pedagogical' or 'Leipzig', while the value for the gloss is the gloss itself, e.g. '<span style='font-variant: small-caps;'>DET</span>' or 'hand' or '<span style='font-variant: small-caps;'>CAUS</span>'. Each `Morpheme` requires a gloss, even if the field is an empty string.",
                        "type": "object",
                        "minProperties": 1,

                        "patternProperties": {
                          "^[(a-z)|(A-Z)|(0-9)]+$": { "type": "string", "title": "Gloss" }
                        },

                        "additionalProperties": false
                      },

                      "tags": {
                        "type": "array",
                        "uniqueItems": true,
                        "items": { "$ref": "#/definitions/tag" }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
